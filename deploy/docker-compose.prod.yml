version: "3.8"

services:
  app:
    # ECR image reference is provided by CodeDeploy hook via ECR_IMAGE env var
    image: ${ECR_IMAGE}
    container_name: batch-kafka-app
    ports:
      - "8080:8080"
    mem_limit: 1.5g
    memswap_limit: 1.5g
    environment:
      # JVM 메모리 제한 (t3.small 2GB 최적화 - Native Memory 포함)
      JAVA_TOOL_OPTIONS: -Xms256m -Xmx512m -XX:MaxMetaspaceSize=128m -XX:MaxDirectMemorySize=128m -Duser.timezone=Asia/Seoul -Dfile.encoding=UTF-8
    env_file:
      - /opt/batch-kafka/.env.prod
    restart: unless-stopped

